{% extends "base.html" %}
{% block content %}

{% if not session.user %}
<h5 class="center-align text-shadow blue-grey lighten-4 black-text reg-message3">
    Please <a href="{{ url_for('login') }}">Login</a> or <a href="{{ url_for('register') }}">Register</a> to view this
    recipe in detail</h5>
{% endif %}

{% if session.user %}
<div class="container">
    <div class="row account-row center-align">
        <div class="col s12 m12 l12 xl12">
            <h3>Welcome {{ username }}</h3>

            <div class="row center-align user-acc-info">
                <div class="col s12 m12 l12 xl12">
                    <p>Username: {{ username }}</p>
                    <p>Name: {{ fullname }}</p>
                    <p>Email: {{ email }}</p>
                </div>
            </div>

            <div class="row">
                <div class="col s12 m6 xl6 push-xl1">
                    <a href="{{ url_for('change_username', username=session.user) }}"
                        class="btn blue-grey darken-1 acc-change-btn text-shadow">Change Username 
                        <i class="fas fa-edit"></i></a>
                </div>

                <div class="col s12 m6 xl6 pull-xl1">
                    <a href="{{ url_for('change_password', username=session.user) }}"
                        class="btn blue-grey darken-1 acc-change-btn text-shadow">Change Password 
                        <i class="fas fa-edit"></i></a>
                </div>
            </div>

            <div class="row center-align">
                {% if num_of_user_recipes >= 1 %}
                <div class="col s10 offset-s1 m10 offset-m1 l10 offset-l1 xl8 offset-xl2">
                    <a href="{{ url_for('add_recipe') }}" class="btn blue-grey darken-1 text-shadow add-recipe-btn">
                        Add Recipe <i class="fas fa-plus"></i></a>
                </div>
                {% endif %}
            </div>


            <div class="row center-align">
                <div class="col s10 offset-s1 m10 offset-m1 l10 offset-l1 xl8 offset-xl2">
                    <h4>Your shared and stored recipes ({{ num_of_user_recipes }})</h4>
                </div>
            </div>
        </div>
    </div>
</div>

{% if num_of_user_recipes == 0 %}
<h4 class="results_title center-align">No Recipes Found</h4><br>
<a href="{{ url_for('add_recipe') }}">
    <h5 class="results_title center-align">Create your first recipe here</h5>
</a>
{% else %}

{% for recipe in user_recipes %}
<div class="row all_recipes_row">
    <div class="col s12 m6 l4 xl3">
        <a href="{{ url_for('view_recipe', recipe_id=recipe._id) }}" class="black-text">
            {% if session.user == recipe.created_by %}
            <div class="card text-shadow blue-grey lighten-4 center-align hoverable">
                {% else %}
                <div class="card text-shadow blue-grey lighten-5 center-align hoverable">
                    {% endif %}
                    <div class="card-title center-align">
                        <h4>{{ recipe.recipe_name }}</h4>
                    </div>

                    <table class="meal-attributes">
                        <thead>
                            <tr>
                                <th>Meal</th>
                                <th>Cuisine</th>
                                <th>Diet</th>
                            </tr>
                        </thead>

                        <tbody>
                            <tr>
                                <td>
                                    {% if not recipe.recipe_meal_type %}
                                    <p>-</p>
                                    {% else %}
                                    <p>{{ recipe.recipe_meal_type }}</p>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if not recipe.recipe_cuisine_type %}
                                    <p>-</p>
                                    {% else %}
                                    <p>{{ recipe.recipe_cuisine_type }}</p>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if not recipe.recipe_diet_type %}
                                    <p>-</p>
                                    {% else %}
                                    <p>{{ recipe.recipe_diet_type }}</p>
                                    {% endif %}
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="card-image s12">

                        {% if recipe.recipe_image_url %}
                        <img src="{{ recipe.recipe_image_url }}" alt="Recipe Image Placeholder" />
                        {% else %}
                        <div class="default-img">
                            <p>Sorry<br>No Image<br>Provided</p>
                        </div>
                        {% endif %}
                    </div>

                    <table class="meal-attributes">
                        <thead>
                            <tr>
                                <th>Cooking Time</th>
                                <th>Servings</th>
                            </tr>
                        </thead>

                        <tbody>
                            <tr>
                                <td>{{ recipe.recipe_cooktime }} Minutes</td>
                                <td>{{ recipe.recipe_servings }} People</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="card-content">
                        <p class="truncate">{{ recipe.recipe_description }}</p>
                        <div class="col s12 m12 l12 xl12">
                            <a href="{{ url_for('view_recipe', recipe_id=recipe._id) }}"
                                class="btn blue-grey darken-1 text-shadow uppercase">View <i
                                    class="fab fa-readme"></i></a>

                            {% if session.user == recipe.created_by %}
                            <a href="{{ url_for('edit_recipe', recipe_id=recipe._id) }}"
                                class="btn blue-grey darken-1 text-shadow uppercase">
                                Edit <i class="fas fa-edit"></i></a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </a>
    </div>
</div>
{% endfor %}
{% endif %}
{% endif %}

{% endblock %}