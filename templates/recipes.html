{% extends "base.html" %}
{% block content %}

{% if not session.user %}
<h5 class="center-align text-shadow blue-grey lighten-4 black-text reg-message2">Want Full Access? <a
        href="{{ url_for('register') }}">Register Now!</a></h5>
{% endif %}

<div class="row">
    <div class="col s12">
        <h4 class="center-align text-shadow all_recipe_title">All Recipes ({{ num_of_recipes }})</h4>
    </div>
</div>

<!--Search Recipe-->
<div class="row search-row">
    <form action="{{ url_for('search') }}" method="post" class="search-bar-form">
        <div class="row">
            <div class="input-field col s11 m10 offset-m1 l8 offset-l2 xl6 offset-xl3 ">
                <i class="fas fa-search prefix blue-grey-text lighten-4"></i>
                <input type="text" name="search_query" id="search_query" minlength="2" maxlength="50"
                    pattern="^[A-Za-z0-9\W+]{2,50}$" class="validate" required>
                <label for="search_query">Search Recipes</label>
                <span class="helper-text col s10" data-error="Search must be 2 characters or more 
                    and can be recipe names, cuisines, diet type and more"></span>
            </div>
        </div>
        <div class="row">
            <div class="col s12 center-align">
                <a href="{{ url_for('all_recipes') }}" class="btn blue-grey lighten-5 text-shadow black-text">Reset</a>
                <button type="submit" class="btn blue-grey darken-1 text-shadow uppercase">
                    <i class="fas fa-search left"></i> Search
                </button>
            </div>
        </div>
</div>
</form>

{% if num_of_recipes_search == 0 %}
<h4 class="results_title center-align">No Results Found<br><br>Please Use Another Search Term</h4>
<div class="row">
    <div class="col s10 m12 l12 xl6">
        <a href="{{ url_for('all_recipes') }}" class="col s6 offset-s4 m4 offset-m4
    l4 offset-l4 xl6 offset-xl9 btn blue-grey darken-1 text-shadow white-text">
            Clear Search <i class="fas fa-times"></i></a>
    </div>
</div>
{% else %}
<h4 class="results_title center-align">{{ search_results }}</h4>
{% endif %}

{% for recipe in recipes %}
<div class="row all_recipes_row">
    <div class="col s12 m6 l4 xl3">
        <a href="{{ url_for('view_recipe', recipe_id=recipe._id) }}" class="black-text">
            {% if session.user == recipe.created_by %}
            <div class="card text-shadow blue-grey lighten-4 center-align hoverable">
                {% else %}
                <div class="card text-shadow blue-grey lighten-5 center-align hoverable">
                    {% endif %}
                    <div class="card-title center-align">
                        <h4>{{ recipe.recipe_name }}</h4>
                    </div>

                    <table class="meal-attributes">
                        <thead>
                            <tr>
                                <th>Meal</th>
                                <th>Cuisine</th>
                                <th>Diet</th>
                            </tr>
                        </thead>

                        <tbody>
                            <tr>
                                <td>
                                    {% if not recipe.recipe_meal_type %}
                                    <p>-</p>
                                    {% else %}
                                    <p>{{ recipe.recipe_meal_type }}</p>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if not recipe.recipe_cuisine_type %}
                                    <p>-</p>
                                    {% else %}
                                    <p>{{ recipe.recipe_cuisine_type }}</p>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if not recipe.recipe_diet_type %}
                                    <p>-</p>
                                    {% else %}
                                    <p>{{ recipe.recipe_diet_type }}</p>
                                    {% endif %}
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="card-image s12">

                        {% if recipe.recipe_image_url %}
                        <img src="{{ recipe.recipe_image_url }}" alt="Recipe Image Placeholder" />
                        {% else %}
                        <img src="{{ url_for('static', filename='icons/utensils-solid.svg') }}" class="default-image"
                            alt="Default Image Placeholder" />
                        {% endif %}
                    </div>

                    <table class="meal-attributes">
                        <thead>
                            <tr>
                                <th>Cooking Time</th>
                                <th>Servings</th>
                            </tr>
                        </thead>

                        <tbody>
                            <tr>
                                <td>{{ recipe.recipe_cooktime }} Minutes</td>
                                <td>{{ recipe.recipe_servings }} People</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="card-content">
                        <p class="truncate">{{ recipe.recipe_description }}</p>
                        <div class="col s12 m12 l12 xl12">
                            <a href="{{ url_for('view_recipe', recipe_id=recipe._id) }}"
                                class="btn blue-grey darken-1 text-shadow uppercase">View <i
                                    class="fab fa-readme"></i></a>

                            {% if session.user == recipe.created_by %}
                            <a href="#" class="btn blue-grey darken-1 text-shadow uppercase">
                                Edit <i class="fas fa-edit"></i></a>

                            <a href="#" class="btn blue-grey darken-1 text-shadow uppercase">
                                Delete <i class="fas fa-trash-alt"></i></a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </a>
    </div>
</div>
{% endfor %}

<div class="row">
    <div class="col s12 xl12">
        <!--Pagination-->
        <ul class="pagination text-shadow center-align">
            {% for page_number in num_of_pages %}
            {% if page_number == current_page %}
            <li class="active blue-grey darken-1"><a>{{ page_number }}</a></li>
            {% else %}
            <li class="waves-effect">
                <a href="{{ url_for('all_recipes', current_page=page_number) }}">{{ page_number }}</a>
            </li>
            {% endif %}
            {% endfor %}
        </ul>
    </div>
</div>
{% endblock %}